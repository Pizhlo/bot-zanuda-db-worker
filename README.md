# Bot Zanuda DB Worker

–°–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ RabbitMQ.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd bot-zanuda-db-worker

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod download

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
make run
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–°–µ—Ä–≤–∏—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª. –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è:

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
```yaml
note: # –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
    operations: # –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–¥ –º–æ–¥–µ–ª—å—é
      create_notes:
        type: create
        storage: postgres # —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
        table: notes.notes # –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –º–æ–¥–µ–ª—å
        fields: # –ø–æ–ª—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏
          text:
            type: string
            required: true
            validation:
              - type: not_empty
              - type: max_length
                max_length: 10000
```

### –û–ø–µ—Ä–∞—Ü–∏–∏
–í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: `create`, `update`, `delete`.

### –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```yaml
request: # –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
          from: rabbitmq
          config:
            address: "amqp://user:password@localhost:5672/"
            queue: notes
            routing_key: create # –∏–ª–∏ update, delete
            message:
              operation:
                type: string
                required: true
                value: "create"
```

## üê∞ RabbitMQ Architecture

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Topic Exchange** –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π:

### Exchange
- **–ò–º—è**: `notes`
- **–¢–∏–ø**: `topic`
- **–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å**: `true`

### Routing Keys
- `create` - –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è
- `update` - –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
- `delete` - –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —É–¥–∞–ª–µ–Ω–∏—è

### –û—á–µ—Ä–µ–¥–∏
–ö–∞–∂–¥—ã–π worker —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å —Å –∏–º–µ–Ω–µ–º: `{topic}_{operation}_{routing_key}`

–ù–∞–ø—Ä–∏–º–µ—Ä:
- `notes_create_create` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è
- `notes_update_update` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `notes_delete_delete` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —É–¥–∞–ª–µ–Ω–∏—è

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ routing key, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–ø–µ—Ä–∞—Ü–∏–∏:

```json
{
  "operation": "create",
  "request_id": "uuid",
  "text": "–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏"
}
```

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ exchange `notes` —Å routing key `create`.

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ –ø—É—Ç–∏ - `internal/config/testdata/valid_model.yaml`.

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ